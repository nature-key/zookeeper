

zookeeper 是一个开源项目，为分布式应用提供协调服务的Apache项目
zookeeper从设计模式理解，是一个基于观察者模式的分布式服务管理框架，他负责存储和管理大家关心的数据，然后接受观察者
的注册，一旦数据发生变化，zookeeper就会通知所有的注册者，那些观察者做出反应，从而实现类似主从管理模式

zookeeper =文件管理+通知机制
主要存储一些配置文件

应用场景
  提供的服务包括，分布式消息同步，协调机制，服务的动态上下线，统一的的配置，负载均衡，集群管理
    1.消息的推送
      服务注册zookeeper，如果配置有更改就会通知我
    2.负载均衡
        
        服务把域名注册到zeekeeper上，进行解析，当客户端请求的时候，我就知道到那一台服务上，动态的
        更改ip:port，不需要写死，如果配置更改，需要手动改      
   3.集群管理
    有多少机器工作，
    每台机器的运行状态集群
    对集群的设备进行上下操作
    分布式任务的庄稼汇报

参数详解
  ticktime：服务端和客户端的心跳时间间隔 默认2000 ms
  dataDir :储存内存中的数据跨找位置
  clientPort端口
  initLimit:初始的时候，客户端连接服务端能容忍的最爱心跳声 ，默认 10  10*2000
  synclimit:同步数据，leader和 Follower 之间请求答应的消息，不能超过
  多少个ticktime 默认5*2000

  数据结构
   zookeeper数据模型的就够和unix文件系统类似，整体可以看成一棵树
   每个节点是一个znode,
   很显然zookeeper集群维护了一套数据结构，储存了一个树形结构，其实每一个节点，称znode,每一个node,chucun 
   储存1mb的数据，每个node通过路径唯一标识

领导选举
 1.有5台机器
 2.1号机器启动 ，先投资及一票，没有过半
 3。2好机器启动，两台机器都投自己一票，但是2号机器的id大
    所以1号的票给了2号，还是没有过半，
 4.3号机器启动，互相投自己一票，然后3id大，再次投票
   都把票给了3号，3号就是leader
 5,4,5号启动，最后只能也抵不过3号领导，
 
 特点
 1.一个领导多个跟随者组成集群
 2，leader负责进行投票发起和决议，更新系统
 3，Follower用于接受客户请求并向客户端结果，
 4.集群超过半数，zookeeper集群才能正常服务
 5.全局数据一致，每一个server保存一分数据的数据副班，
 无论链接那个server数据都一直
 6，更细请求顺序进行，来自同一个client更新请求按期顺序依次执行
 7，数据更新原子性，数据更新要么成功，要么失败
 8，实时性，在一定范围时间，client可读到最新消息

节点类型
 创建 create  /xiyou   "niah" 
     -s 带顺序编号
     -e 短暂的节点
 获取 get  /xiyou
 设置 set  /xiyou "dd"


  短暂：客户端和服务器断开，就删除节点
  持久：客户端和服务器断开，不删除节点 （默认创建的是持久的）

节点形式
1.持久化目录节点
2.持久化目录节点 顺序编号目录
3，临时目录节点
4，临时目录顺序编号节点


get  /xiyou  watch 监控

set /xiyou  "ddd"   节点的值


ls /xiyou  watch
create /xiyou/test "test"  路径的节点的控制


delete /xiyou
rmr /xuyou   逐个删除
stat /xuyou  获取节点状态


监听原理
1.有一个主线程
2.创建zkclient 建立两条线程 lister 和 connect
3.connect会把监听的事件注册到zk上
4，zk上有注册的注册列表
5.当注册列表发生变化，就会通知lister
6.然后就把变化交给process处理



服务器动态上下线案例
1，服务器启动注册信息到zk集群
2.集群记录服务的ip 端口，配置信息
3.激情就去getchildren，渠道当前在线服务器liebiao,并注册监听

4.当服务下线，节点就会消失，
5.process重新去获取服务器列表并注册监听















































